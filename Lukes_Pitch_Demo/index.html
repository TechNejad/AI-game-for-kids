<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axiom OS v.7.3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1a26;
            --screen-bg: #0c2c3a;
            --border-color: #33b5e5;
            --text-color: #e0f7fa;
            --logos-color: #ffffff;
            --kairos-color: #ffd700;
            --alert-color: #ff4444;
            --bnl-blue: #007ac1;
            --bnl-yellow: #f8c500;
            --font-main: 'Roboto Mono', monospace;
            --font-display: 'VT323', monospace;
            --border-radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        .scanlines::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%;
            z-index: 2;
            pointer-events: none;
            animation: scanline 10s linear infinite;
        }

        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100vh; }
        }

        #os-container {
            width: 100%;
            max-width: 1200px;
            height: 95vh;
            max-height: 800px;
            background-color: var(--screen-bg);
            border: 3px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 0 25px rgba(51, 181, 229, 0.4), inset 0 0 15px rgba(51, 181, 229, 0.2);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Header Bar */
        #header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            background-color: rgba(0,0,0,0.2);
            border-bottom: 2px solid var(--border-color);
            font-family: var(--font-display);
            font-size: 1.5rem;
            text-shadow: 0 0 5px var(--border-color);
        }

        #header-bar .bnl-logo {
            font-weight: bold;
            color: var(--bnl-blue);
        }
        #header-bar .bnl-logo span {
            color: var(--bnl-yellow);
        }

        /* Main Window */
        #main-interaction-window {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .view {
            display: none;
            width: 100%;
            height: 100%;
        }
        .view.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Command Terminal */
        #message-log {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 15px;
        }

        .message {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .message .sender {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            text-shadow: 0 0 8px;
        }

        .sender.logos { color: var(--logos-color); }
        .sender.kairos { color: var(--kairos-color); }
        
        .message-content {
            white-space: pre-wrap;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }

        #choice-container {
            display: flex;
            gap: 15px;
            padding-top: 10px;
            border-top: 1px dashed rgba(51, 181, 229, 0.3);
        }

        .choice-button {
            flex-grow: 1;
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--border-color);
            padding: 12px 15px;
            font-family: var(--font-main);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            text-align: left;
        }
        .choice-button:hover {
            background-color: var(--border-color);
            color: var(--screen-bg);
        }

        /* Schematics View */
        #schematics-view {
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #schematics-view h2 {
            color: var(--alert-color);
            font-family: var(--font-display);
            font-size: 3rem;
            text-shadow: 0 0 10px var(--alert-color);
            animation: pulse 1.5s infinite;
        }
        #schematics-view p { margin-bottom: 20px; }
        #schematics-image {
            max-width: 80%;
            border: 2px solid var(--border-color);
            padding: 10px;
            background: rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .schematics-button {
            background-color: var(--bnl-yellow);
            color: var(--bg-color);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
        }
        .schematics-button:hover {
            opacity: 0.9;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Chronos Log View */
        #chronos-log-view {
             padding: 20px;
             overflow-y: auto;
        }
        .log-entry {
            background-color: rgba(0,0,0,0.2);
            border-left: 4px solid var(--bnl-yellow);
            padding: 15px;
            margin-bottom: 15px;
        }
        .log-entry h3 {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--bnl-yellow);
        }

        /* Taskbar */
        #taskbar {
            display: flex;
            border-top: 2px solid var(--border-color);
            background-color: rgba(0,0,0,0.2);
        }
        .taskbar-button {
            flex: 1;
            padding: 12px 0;
            background: transparent;
            border: none;
            border-right: 1px solid var(--border-color);
            color: var(--text-color);
            font-family: var(--font-display);
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .taskbar-button:last-child { border-right: none; }
        .taskbar-button.active, .taskbar-button:hover {
            background-color: var(--border-color);
            color: var(--screen-bg);
            text-shadow: none;
        }
        .taskbar-button.alert {
            animation: alert-flash 1s infinite;
        }
        @keyframes alert-flash {
            0%, 100% { background-color: transparent; color: var(--alert-color); }
            50% { background-color: var(--alert-color); color: var(--bg-color); }
        }


        /* LifeStat Monitor */
        #lifestat-monitor {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            border-top: 2px solid var(--border-color);
            background-color: rgba(0,0,0,0.4);
            font-family: var(--font-display);
            font-size: 1.4rem;
        }
        .stat { display: flex; align-items: center; gap: 10px; }
        .stat-label { opacity: 0.7; }
        .stat-value { color: var(--bnl-yellow); text-shadow: 0 0 5px var(--bnl-yellow); }

    </style>
</head>
<body>

    <div id="os-container" class="scanlines">
        <!-- Header Bar -->
        <header id="header-bar">
            <div>AVALON OS v.7.3</div>
            <div class="user-info">[User: #P7814]</div>
            <div class="bnl-logo">Buy<span>n</span>Large</div>
        </header>

        <!-- Main Interaction Window -->
        <main id="main-interaction-window">
            <div id="terminal-view" class="view active">
                <div id="message-log"></div>
                <div id="choice-container"></div>
            </div>
            <div id="schematics-view" class="view">
                <h2>CRITICAL ALERT: LIFE SUPPORT FAILURE</h2>
                <p>Unscheduled cryo-pod discharge detected in Medical Bay. Power conduit overload imminent.</p>
                 <img id="schematics-image" src="https://placehold.co/600x200/0c2c3a/33b5e5?text=Ship+Schematic+-+Medical+Bay" alt="Ship Schematic">
                <button id="reroute-button" class="schematics-button">REROUTE AUXILIARY POWER</button>
            </div>
            <div id="chronos-log-view" class="view">
                <div class="log-entry">
                    <h3>LOG #224-A: Pre-flight Checklist</h3>
                    <p>"Chief Engineer signing off. All systems green. The 'Avalon' is ready for her long sleep. Sometimes I wonder if these BnL budget cuts went too deep on the coolant relays. Nah, I'm sure it's fine."</p>
                </div>
                 <div class="log-entry">
                    <h3>LOG #198-C: Passenger Manifest Note</h3>
                    <p>"Psychologist's Note: Passenger #P7814 selected for high resilience and problem-solving skills. In the unlikely event of a mid-journey incident, they are the primary candidate for emergency awakening."</p>
                </div>
            </div>
        </main>

        <!-- Taskbar -->
        <nav id="taskbar">
            <button id="terminal-btn" class="taskbar-button active">COMMAND TERMINAL</button>
            <button id="schematics-btn" class="taskbar-button">SHIP SCHEMATICS</button>
            <button id="log-btn" class="taskbar-button">CHRONOS LOG</button>
        </nav>

        <!-- LifeStat Monitor -->
        <footer id="lifestat-monitor">
            <div class="stat">
                <span class="stat-label">HEART RATE:</span>
                <span id="hr-value" class="stat-value">85 BPM</span>
            </div>
            <div class="stat">
                <span class="stat-label">STRESS:</span>
                <span id="stress-value" class="stat-value">45% | ELEVATED</span>
            </div>
            <div class="stat">
                <span class="stat-label">FATIGUE:</span>
                <span id="fatigue-value" class="stat-value">68% | HIGH</span>
            </div>
        </footer>
    </div>

    <script>
        const gameData = {
            'START': {
                messages: [
                    { sender: 'LOGOS', text: 'Calibrating sensory input... Emergency awakening protocol complete. Passenger #P7814, you are awake.' },
                    { sender: 'KAIROS', text: 'Easy now... I know this must be disorienting. My name is Kairos. I\'m here to help you. The ship... has sustained critical damage.' },
                    { sender: 'LOGOS', text: 'Stardate: 225-08:14. Mission elapsed time: 30 years. You have been awakened 90 years ahead of schedule. Your cryo-pod was the only one that survived the initial impact.' },
                ],
                choices: [
                    { text: '"What happened? Where is everyone?"', nextNode: 'EXPLANATION' },
                    { text: '"Just tell me what needs to be done."', nextNode: 'DIRECT_ACTION' }
                ],
                statChanges: { stress: 5 }
            },
            'EXPLANATION': {
                 messages: [
                    { sender: 'LOGOS', text: 'An unknown object breached the hull near the primary reactor. The resulting explosion destroyed 99.98% of the cryo-bays. You are the sole survivor.' },
                    { sender: 'KAIROS', text: 'I am so sorry. There was nothing that could be done to save them. Right now, our focus has to be on you, and keeping the ship stable.' }
                ],
                choices: [
                    { text: 'Continue...', nextNode: 'CRISIS_START' }
                ],
                statChanges: { stress: 15, fatigue: 5 }
            },
             'DIRECT_ACTION': {
                messages: [
                    { sender: 'LOGOS', text: 'Acknowledged. Current priority is stabilizing the life support system, which is fluctuating due to power surges from the damaged reactor.' },
                    { sender: 'KAIROS', text: 'He means we need to stop things from getting worse before we can think about getting better. Your survival is paramount.' }
                ],
                choices: [
                     { text: 'Understood. Let\'s get to it.', nextNode: 'CRISIS_START' }
                ],
                statChanges: { stress: -5 }
            },
            'CRISIS_START': {
                isEvent: true,
                eventType: 'ALERT',
                nextNode: 'CRISIS_RESOLUTION'
            },
            'CRISIS_RESOLUTION': {
                messages: [
                    { sender: 'LOGOS', text: 'Power rerouted successfully. Life support stabilized. Your intervention has prevented total system failure.' },
                    { sender: 'KAIROS', text: 'You did it! That was incredible. See? There\'s hope. We just need to take this one step at a time.' }
                ],
                choices: [
                     { text: 'What\'s next?', nextNode: 'NEXT_STEP' }
                ],
                statChanges: { stress: -20, fatigue: 10 }
            },
            'NEXT_STEP': {
                 messages: [
                    { sender: 'LOGOS', text: 'The next logical step is a full diagnostic of the reactor core. However, my sensors are limited. A manual inspection is required.' },
                    { sender: 'KAIROS', text: 'That\'s... dangerous. The core is unstable. But he\'s right, we\'re flying blind without more information. The choice is yours.' }
                ],
                choices: [
                    { text: 'I\'ll do it. Prep the maintenance drone.', nextNode: 'END' },
                    { text: 'There has to be another way.', nextNode: 'END' }
                ]
            },
            'END': {
                messages: [
                    { sender: 'KAIROS', text: 'Okay... Let\'s get ready.' },
                    { sender: 'LOGOS', text: 'To be continued...' }
                ],
                choices: []
            }
        };

        const state = {
            currentNodeKey: 'START',
            stats: {
                hr: 85,
                stress: 45,
                fatigue: 68
            }
        };

        const messageLog = document.getElementById('message-log');
        const choiceContainer = document.getElementById('choice-container');
        
        const hrValue = document.getElementById('hr-value');
        const stressValue = document.getElementById('stress-value');
        const fatigueValue = document.getElementById('fatigue-value');

        const views = {
            terminal: document.getElementById('terminal-view'),
            schematics: document.getElementById('schematics-view'),
            log: document.getElementById('chronos-log-view')
        };
        const taskbarButtons = {
            terminal: document.getElementById('terminal-btn'),
            schematics: document.getElementById('schematics-btn'),
            log: document.getElementById('log-btn')
        };

        function typeMessage(message, callback) {
            const messageEl = document.createElement('div');
            messageEl.className = 'message';
            
            const senderEl = document.createElement('span');
            senderEl.className = `sender ${message.sender.toLowerCase()}`;
            senderEl.textContent = `// ${message.sender}`;
            
            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';

            messageEl.appendChild(senderEl);
            messageEl.appendChild(contentEl);
            messageLog.appendChild(messageEl);

            let i = 0;
            const speed = 20; // typing speed
            function type() {
                if (i < message.text.length) {
                    contentEl.innerHTML += message.text.charAt(i);
                    i++;
                    messageLog.scrollTop = messageLog.scrollHeight;
                    setTimeout(type, speed);
                } else {
                    if (callback) callback();
                }
            }
            type();
        }

        function displayNode(nodeKey) {
            const node = gameData[nodeKey];
            if (!node) return;

            state.currentNodeKey = nodeKey;
            choiceContainer.innerHTML = '';
            
            if (node.isEvent && node.eventType === 'ALERT') {
                handleAlertEvent(node);
                return;
            }

            // Type out messages sequentially
            let messageIndex = 0;
            function nextMessage() {
                if (messageIndex < node.messages.length) {
                    typeMessage(node.messages[messageIndex], nextMessage);
                    messageIndex++;
                } else {
                    // All messages displayed, now show choices
                    renderChoices(node.choices);
                }
            }
            nextMessage();
            
            if(node.statChanges) {
                updateStats(node.statChanges);
            }
        }

        function renderChoices(choices) {
            if (!choices) return;
            choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice.text;
                button.onclick = () => selectChoice(choice);
                choiceContainer.appendChild(button);
            });
        }

        function selectChoice(choice) {
            messageLog.innerHTML += `<div class="message message--user"><div class="message-content" style="background: var(--bnl-blue); color: white; align-self: flex-end; border-radius: 8px; padding: 10px; text-align: right;">> ${choice.text}</div></div>`;
            messageLog.scrollTop = messageLog.scrollHeight;
            displayNode(choice.nextNode);
        }
        
        function updateStats(changes) {
            if (changes.hr) state.stats.hr += changes.hr;
            if (changes.stress) state.stats.stress += changes.stress;
            if (changes.fatigue) state.stats.fatigue += changes.fatigue;

            // Clamp values
            state.stats.stress = Math.max(0, Math.min(100, state.stats.stress));
            state.stats.fatigue = Math.max(0, Math.min(100, state.stats.fatigue));
            
            state.stats.hr = 70 + Math.floor(state.stats.stress * 0.5);

            hrValue.textContent = `${state.stats.hr} BPM`;
            
            let stressLevel = 'NORMAL';
            if (state.stats.stress > 75) stressLevel = 'CRITICAL';
            else if (state.stats.stress > 40) stressLevel = 'ELEVATED';
            stressValue.textContent = `${state.stats.stress}% | ${stressLevel}`;
            
            let fatigueLevel = 'LOW';
            if (state.stats.fatigue > 75) fatigueLevel = 'SEVERE';
            else if (state.stats.fatigue > 50) fatigueLevel = 'HIGH';
            fatigueValue.textContent = `${state.stats.fatigue}% | ${fatigueLevel}`;
        }
        
        function handleAlertEvent(node) {
            taskbarButtons.schematics.classList.add('alert');
            const alertMessage = { sender: 'LOGOS', text: '!!! CRITICAL ALERT DETECTED. IMMEDIATE ACTION REQUIRED. SWITCHING TO SHIP SCHEMATICS VIEW. !!!' };
            typeMessage(alertMessage, () => {
                setTimeout(() => {
                    switchView('schematics');
                    document.getElementById('reroute-button').onclick = () => {
                        taskbarButtons.schematics.classList.remove('alert');
                        switchView('terminal');
                        displayNode(node.nextNode);
                    };
                }, 1000);
            });
        }
        
        function switchView(viewName) {
            Object.values(views).forEach(v => v.classList.remove('active'));
            Object.values(taskbarButtons).forEach(b => b.classList.remove('active'));
            
            views[viewName].classList.add('active');
            taskbarButtons[viewName].classList.add('active');
        }

        // Initial setup
        Object.keys(taskbarButtons).forEach(key => {
            taskbarButtons[key].onclick = () => switchView(key);
        });
        
        // Start the game
        displayNode('START');

    </script>
</body>
</html>
